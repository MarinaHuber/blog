<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>All things localization - iOS Engineering</title>
  <meta name="author" content="">

  <link
    rel="stylesheet"
    type="text/css"
    href="https://webfonts.artsy.net/all-webfonts.css"
  />

  
  <meta name="description" content="Where to begin! Where to begin‚Ä¶

Localisation is something that occurs in every project I encounter. 
I found that having a list of useful tips tha...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:image" content="http://artsy.github.io/images/artsy_oss_image.png" />
  <meta property="og:image:type" content="image/png" />

  
  <link rel="canonical" href="https://marinahuber.github.io/blog/2024/03/07/nextjs-at-artsy-retrospective/">
  <link rel="alternate" type="application/rss+xml" title="Artsy Engineering Blog" href="/feed">
  <link rel="alternate" type="application/atom+xml" title="Podcast Feed" href="/podcast.xml" />

  <link href="/favicon.ico" rel="icon">
  <link href="/blog/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <script src="/blog/javascripts/jquery-1.11.3.min.js"> </script>
  <script src="/blog/javascripts/gradient-fade.js"></script>
  <script src="/blog/javascripts/noframework.waypoints.min.js"></script>
  <script src="/blog/javascripts/sticky.min.js"></script>
  <script src="/blog/javascripts/custom-elements.min.js"></script>
  <script src="/blog/javascripts/g-emoji-element.js"></script>
  <script src="/blog/javascripts/related-articles.js"></script>

  

  <link href="/feed.xml" rel="alternate" title="iOS Engineering" type="application/atom+xml">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12450662-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<link href="/css/epic.css" media="screen, projection" rel="stylesheet" type="text/css">



<body>
  <div>
    <div id="bodywrapper">
      <header>
        <ul>
          <li><a href="/">Artsy Engineering Blog</a></li>
          <li><a href="https://www.artsy.net/jobs">Careers</a></li>
          <li><a href="https://github.com/artsy">Github</a></li>
        </ul>

        <ul>
          <li><a href="https://github.com/orgs/artsy/repositories?language=&q=&sort=&type=source">Our Open Source</a></li>
          <li><a href="http://twitter.com/artsyopensource">@artsyopensource</a></li>
          <li><a href="https://www.artsy.net">artsy.net</a></li>
        </ul>
      </header>

      <section>
        <header id="page">
          <h1>All things localization</h1>
          <h3>
          <!-- Yep, single line so the comma lines up right -->
          By 
          </h3>
          <time datetime="2024-03-07">Mar 7, 2024</time>
        </header>

        <article class='post'>
          <p>Where to begin! Where to begin‚Ä¶</p>

<p>Localisation is something that occurs in every project I encounter. <br />
I found that having a list of useful tips that cover most aspect of localisation is essential, 
so that is why I created this post and is in progress.
There is a slight distinction between internationalization and localization:
Internationalization ‚Äî the process of making your app able to adapt to different languages, regions, and cultures.
Localization ‚Äî the process of translating your app into multiple languages.
So, in total it depends on context, and namely on the following elements:</p>
<ul>
  <li>user gender</li>
  <li>singular and plural in the text</li>
  <li>platforms: Web, Android, iOS</li>
  <li>the project for which the translation is being done.</li>
</ul>

<!-- more -->

<h3 id="the-problem--app-store">The Problem &amp; App Store:</h3>

<p>In Apple ecosystem if the developer needs to modify any content of the language file, 
the changes needs to be updated in the project and the app needs re-submission.
 Also have you been in that situation where you have pushed a spelling mistake 
 to the App Store? <code class="language-plaintext highlighter-rouge">( ‚óç‚Ä¢·¥ó‚Ä¢‚óç)</code>
ü§üüèΩ There are at least three ways of translating you app.
1 . Custom solution with web service that contains JSON file with translation for all platforms needed.</p>
<ol>
  <li>Dynamically translating it with third party services like Crowdin, Azure Translator, Applanga, BartyCrouch list is long.</li>
  <li>Importing/exporting .string files into Xcode project manually
-exporting Localization Catalog .xcloc containing good old XLIFF file</li>
</ol>

<p>Solution 1:
Custom web service with JSON downloaded on the app launch.</p>
<ul>
  <li>Create small service- in the app you can request the language the device needs and listen to any changes that might occur (simple Firebase DB or any custom robust server with .json file there)</li>
  <li>During the launch wait until you have received a response from web service before you display anything to the user.</li>
  <li>Or, if you do not want to rely on the devices connection, then you can preinstall the dictionary by adding the .json file to the bundles resources and preload on app startup.
This can be pretty straight forward. An this is example how your .json file can be formatted. https://simplelocalize.io/docs/file-formats/single-language-json/
Managing the translation into dictionary of strings and reusing it with string extention:
```public class LocalizationService {</li>
</ul>

<p>static var localisation: [String: Any]?</p>

<p>class func getString(with key: String) -&gt; String {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  let missingError = UIDevice.isProduction ? "": String(format: "Missing string for key: %@", key)
  guard let localisation = shared.localisation as NSDictionary? else { return missingError }      
  let localisedString = localisation.value(forKeyPath: key) as? String
  return localisedString ?? missingError    } }```
</code></pre></div></div>

<p>```public extension String {
   var localised: String {
      return LocalizationService.getStringForKey(with: self)
   }
   }</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Note: this is a starting point code reference
Solution 2:
Third party solution and their tradeoffs.
* 		BartyCrouch, Open source project
brew uninstall bartycrouch
Using BartyCrouch and running a few commands from the command line what can even be automated, 
using a build script within your project.
Pros:
in order to keep your Storyboards/XIBs Strings files updated over time
2. make sure your Localizable.strings files stay updated with newly added keys in code 
using NSLocalizedString and show warnings for duplicate keys or empty values
3. use the machine translation feature of Microsoft Translator Text API via translate
4. let BartyCrouch translate it to all supported languages in a single line &amp; 
without ever leaving the code.
Important : Localization Workflow via transform- of BartyCrouch formatted localized Strings 
are not supported by this automatic feature.
Transform from NSLocalizedString or BartyCrouch.translate doesn‚Äôt support the new LocalizedStringKey type yet. 
Not ready to be used in SwiftUI fully (more in this issue)
Steps for BartyCrouch translate:
* 		Set up Azure (the GLOBAL configuration is the option that takes (location) of all near by servers is fastest)
* 		Run the update script in the Compile Sources -
Had some issue here as I am getting success in translation but no output. I posted on Github BartyCrouch OSS
NOTE:‚ùóÔ∏èTroubleshooting BartyCrouch error: no file found Library not loaded:libSwiftSyntax.dylib
* 		Translate feature: LiveDemo

2. Crowdin
I heard a lot of folks in iOS community using this service which is cloud-based localization platform for continuous software localization projects.
With Crowdin you have the option to work with freelance translators and volunteers but also aspecialized software localization company.
Up to 60,000 hosted words it is free of charge.

3. Applanga
Same as Crowdin but much better CI and automation delivery for native platforms.
Basic sunscription starts from 49$month.
Solution 3:
Static localization. No need to use key-based translations:
NSLocalizedString(‚ÄúText‚Äù, value: ‚ÄúHello World‚Äù, comment: ‚ÄúMain label‚Äù)
‚Üí From iOS15 there is no need to use key-based translations üíØ üíØ
Localisation got better from WWDC 2022
String(localised: ‚ÄúText‚Äù, defaultValue: ‚ÄúText‚Äù, comment: ‚ÄúThis is Text‚Äù)

There are omitted details of course, and there were things we needed to figure
out (such as auth, via `next-auth`, and passing runtime ENV secrets to our
Dockerized container), but in any case this gave us a lot of confidence to start
discussing what it might take to seriously consider rebuilding our internal
tools app. A few meetings later it was decided, and our platform team agreed to
take it (with loose backup support from a couple other engineers). And a few
short month's later much of the core functionality was complete, executed by a
team working amidst unfamiliar terrain.

That's the definition of success, and the measure. With our internal tools app
complete it was natural to start looking around for other opportunities -- but
first, a quick detour.

### Enter: Workflow (aka, The `app` default)

U
sually we will start with english as the base language as default, then slowly adding more language support on top of it. Before using any tools we need to prepare our app for DEFAULT language.
By default, a base language will be provided by Xcode, i.e, english. This base language will act as a fallback language if any localizable content is not found. In my test project since I am not using localized STORYBOARDS DefaultLocalizable.string file is the default English language that must contain all the text of the app for fallback.
* 		Create Localizable.string file
* 		Always wrap user-facing strings with (iOS13&amp;14) NSLocalizedString or (from iOS 15+) String(localized:)
* 		Create IBDesignables to add storyboards UI to code
* 		Created swift script called LocalizationScript.swift that takes all Localizable.strings and creates enum from it (this script reads Localizable.sting file and can not distinguish comments from text to translate)
Few tips from session @Apple Localization Lab:
Create Localizable.string file
Always wrap user-facing strings with (iOS13&amp;14) NSLocalizedString or
From iOS 15+ String(localized:)
Create IBDesignables to add storyboards UI to code
Note: Will detect the App language:
NSLocalizedString() ‚Üí short for Bundle.main.localizedString()
Exporting for localization in SwiftUI
New Xcode project build settings Use Compiler to Extract Swift Strings
Once active, before exporting strings for localization, Xcode will build all project targets and use the compiler type information to extract LocalizedStringKeys from your SwiftUI code
In Xcode 13+ .xcloc a.k.a. Xcode Localization Catalogs can be opened directly in Xcode with the new Localization Catalog Editor ü§ôüèΩ
Needs to be set to YES if project uses SwiftUI for Exporting all targets in Catalog
This is the file it will expose into: en.xclocc
You can use comments for easier translation all and more here
Spanish &amp; English language got a new custom Markdown
The main purpose of Automatic Grammar Agreement however, to make the translation of plural and gendered texts
so far better to use stringdict
All edge cases:
Localization of dynamic text
Check the current running application language, if it is Spanish than show the Spanish text, else show the English one.
In case the strings are coming from the internet server:
Bundle.main.preferredLocatizations.first
Plural and Gender Support
using .stringdict
String.localizedStringWithFormat(formatString, count)
If you try to translate English phrases word-for-word into Spanish or German, they will make no sense. For this reason, you may need to create more than one version of each string and write instructions about which variant should be used.
Gender and personalisation:
Using date, currencies and number formatters
More
Dates
Unicode.org for TEMPLATES ‚Üí http://www.unicode.org/reports/tr35/tr35-31/tr35.html
use templates : more make data user-friendly
dateFormatter.locale = Locale(identifier: Locale.preferredLanguages.first ?? ‚Äúen‚Äù)
or use the current locale of the app it is the same result
dateFormatter.locale = .current
Dynamic Dates
coming from translated server
let allServerLanguages = [‚Äùen‚Äù, ‚Äúes‚Äù, ‚Äúde‚Äù, ‚Äúit‚Äù]
let language = Bundle.preferredLocalizations(from: allServerLanguages).first

</code></pre></div></div>
<ul>
  <li>app/
‚Äî- layout.tsx
‚Äî- page.tsx</li>
  <li>app/artist
‚Äî- layout.tsx
‚Äî- page.tsx
‚Äî- middleware.tsx
```</li>
</ul>

<p>And so on. ‚ÄúGlobal‚Äù SSR data could be fetched right there in <code class="language-plaintext highlighter-rouge">layout</code> or <code class="language-plaintext highlighter-rouge">page</code>
and shared with its subtree; and likewise, for sub-sub-tree‚Äôs we could do the
same in each individual app <code class="language-plaintext highlighter-rouge">layout</code> or <code class="language-plaintext highlighter-rouge">page</code> component.</p>

<p>Additionally, with React Server Components, we would no longer need to use many
Next.js-specific APIs. To fetch data on the server, you simply <code class="language-plaintext highlighter-rouge">await</code> a promise
and pass it right to your component as props. Next‚Äôs already minimal API
footprint would diminish even further, and it became possible to glean a vision
of ‚Äújust vanilla JS‚Äù all the way down, and within that vision the possibility of
true simplicity.</p>

<p>Little did we know, it wouldn‚Äôt take much to turn this beautiful vision into
something of a dilemma, but that part of the story comes a bit later.</p>

<h3 id="expanding-nextjs-at-artsy">Expanding Next.js at Artsy</h3>

<p>Coming off of our success with the internal tools app rebuild, we wanted more.
And we didn‚Äôt need to look far: right around the corner was a ~10 year old
external CMS app that our partners use to manage their inventory.</p>

<p>We decided the path forward was Next, and like our internal tools app rebuild,
for the most part it has been a success. We again went with the <code class="language-plaintext highlighter-rouge">pages</code> router
(as the new <code class="language-plaintext highlighter-rouge">app</code> router wasn‚Äôt yet released) and so far there‚Äôs been minimal
confusion from the team. And buisness-wise, its been refreshing to defer
framework design decisions, lib upgrades and more to Next, versus having to
maintain <a href="https://github.com/artsy/force">all of these things in-house</a>.</p>

<p>It‚Äôs also worth mentioning that there <em>have</em> been a few significant challenges
involved (such as setting up performant SSR patterns for using Relay, our
GraphQL client ‚Äì thats another blog post), but on the whole Next has served our
needs well. Team performance was unlocked, and we‚Äôve been able to quickly get to
building and rebuilding CMS pages in this new application. And our engineers
have loved working in it.</p>

<h3 id="back-to-next-13">Back to Next 13</h3>

<p>In the meantime, Next 13 was released. Imagine our excitement! Just as this new
app is spinning up we receive a little gift from the stars. Carlos and I are the
first ones to bite; lets see what migrating our work over to the new framework
might look like, what kind of effort.</p>

<p>From the start, it was immediately obvious that the Next.js team released an
alpha-quality (or less) product, marked as <code class="language-plaintext highlighter-rouge">stable</code>. Not a <code class="language-plaintext highlighter-rouge">beta</code>, not an <code class="language-plaintext highlighter-rouge">RC</code>
to peruse and experiment with, but rather an</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>next
</code></pre></div></div>

<p>package that comes with an application scaffold generator that suggests using
the <code class="language-plaintext highlighter-rouge">app</code> router over <code class="language-plaintext highlighter-rouge">pages</code> ‚Äì marked as <em>‚ÄúRecommended‚Äù</em>. In other words,
highly polished. And what‚Äôs the first thing one experiences?
<a href="https://www.google.com/search?q=next+13+hot+reloading+broken+site:github.com&amp;sca_esv=b6c25dbec4ffd71b&amp;sa=X&amp;ved=2ahUKEwjlmtTR_eKEAxW4CjQIHTqPAJYQrQIoBHoECBgQBQ&amp;biw=1512&amp;bih=829&amp;dpr=2#ip=1">Hot Reloading is broken</a>.</p>

<p>And what‚Äôs the next thing? Styles are broken. It turns out that RSC (React
Server Components) doesn‚Äôt fully support pre-existing CSS-in-JS patterns. Or
rather,
<a href="https://nextjs.org/docs/app/building-your-application/styling/css-in-js#styled-components">they do, kind of</a>,
but they can only be used inside <code class="language-plaintext highlighter-rouge">use client</code> components (which, in Next.js,
actually means a server-side rendered component environment that‚Äôs <em>separate
from</em> a RSC rendered ‚Äúserver-only‚Äù environment ‚Äì aka the old pages router
model). And we certainly weren‚Äôt about to throw out our Design System component
library <a href="https://github.com/artsy/palette">Palette</a>, which has been nothing but
a runaway success (and a
<a href="https://github.com/artsy/palette-mobile">highly portable one</a> at that).</p>

<p>With this limitation, our ability to use React Server Components had been
severely hampered. Excluding the root-most level of our component tree, we were
now required to prepend <code class="language-plaintext highlighter-rouge">use client</code> on the top of every component, lest we
receive ambiguous errors about rendering a client component (which used to be
server-side render safe) on the ‚ÄúRSC server‚Äù.</p>

<p>Things can be taught, however. So lets proceed from the assumption that through
some kind of tooling / linting layer, <code class="language-plaintext highlighter-rouge">use client</code> is added to every new
component. It <em>should</em> behave at that point just like the old Next and now we
get the best of both worlds. Nope: turns out that even with the CSS-in-JS setup
instructions described in the the next docs above, we still run into issues.
There are bugs.</p>

<p>(These are the two main red flags, but there are many others as well.)</p>

<p>At this point, we wisely back out. It‚Äôs only <code class="language-plaintext highlighter-rouge">next@13.0.0</code>, and what they‚Äôre
doing here is to a certain extent revolutionary. It‚Äôs a new way of thinking
about React, yet an old way of thinking about page rendering. It‚Äôs like‚Ä¶ PHP,
or so they say. RSC is <em>interesting</em>, there‚Äôs something to it. Lets give them
the benefit of the doubt and return to things in a few months, after a few
<code class="language-plaintext highlighter-rouge">minor</code> version bumps; there are, after all, countless eyes on the project.</p>

<h3 id="many-months-later">Many Months Later</h3>

<p>We run <code class="language-plaintext highlighter-rouge">npx create-next-app@latest</code> (this is around the time they release
<code class="language-plaintext highlighter-rouge">13.4</code>) and then add these two components inside the newly-created vanilla
project:</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/HelloClient.tsx</span>
<span class="dl">'</span><span class="s1">use client</span><span class="dl">'</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">HelloClient</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Does this hot reload<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">}</span>

<span class="c1">// app/layout.tsx</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HelloClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./HelloClient</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Layout</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nc">HelloClient</span> <span class="p">/&gt;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Everything renders. And then</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">HelloClient</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Does this hot reload... nope :(<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the most basic project setup, the most obvious Next.js selling point ‚Äì
Developer Experience ‚Äì failed to deliver. Vercel is really forcing us to
question things. But we‚Äôre flexible, and we like to investigate at Artsy, so
even though this definitely-required feature doesn‚Äôt quite work, maybe it will
once we‚Äôre done with our migration spike, and maybe we can still take advantage
of everything else that RSC has to offer.</p>

<p>So again, we start refactoring the project. Stuff from the <code class="language-plaintext highlighter-rouge">pages</code> directory
starts getting copied over to <code class="language-plaintext highlighter-rouge">app</code>. We update configuration. We setup styling
(it seems to work better). Things are <em>almost</em> there. But then the obscure
framework errors start to arrive, and CSS still doesn‚Äôt quite work: it turns out
that refactoring across RSC-<code class="language-plaintext highlighter-rouge">use client</code> boundaries is harder than one thought.
I.e., if any piece of ‚Äúclient‚Äù (remember, ‚Äòuse client‚Äô actually means SSR-safe)
code <em>anywhere in the dependency tree</em> happens to intersect an RSC boundary, the
whole thing will fail. And this includes any use of React‚Äôs <code class="language-plaintext highlighter-rouge">createContext</code> ‚Äì
because React Contexts aren‚Äôt supported. Given an app of any reasonable size,
you‚Äôre likely to rely on a context somewhere, as contexts are so critical within
the react hooks model of behavior. Said contexts might come from within your
app, and if not there they‚Äôll certainly come from a 3rd party library.</p>

<p>One would expect the errors to be helpful in tracking this down ‚Äì Next.js is
all about DX ‚Äì but no. Confusion reigns.</p>

<p>We‚Äôre experts though, and we eventually <em>do</em> find the source of the violation,
and we make sure to create a ‚Äúsafety wrapper‚Äù around the offender so that it
doesn‚Äôt happen again. But it does happens again ‚Äì and again, any time any piece
of any complexity is added in the new RSC-intersected route. It‚Äôs rather
unavoidable. And each time solvable, but at a great cost to the developer.
Thankfully we know what we‚Äôre doing!</p>

<p>Another trivial yet annoying issue (thankfully fixed with some custom eslint
config) is accidentally importing the <code class="language-plaintext highlighter-rouge">useRouter</code> hook from the <code class="language-plaintext highlighter-rouge">app</code> router
location, or <code class="language-plaintext highlighter-rouge">redirect</code>, or any number of other new <code class="language-plaintext highlighter-rouge">app</code> router features,
because all of these things don‚Äôt work in <code class="language-plaintext highlighter-rouge">pages</code>, and will error out. The
errors here are slightly less opaque, but what if you‚Äôre a backend dev who knows
nothing about any of this? Googling ‚ÄúuseRouter next‚Äù now yields two sets of
docs. Figure it out.</p>

<div style="text-align: center;">
  <img src="https://miro.medium.com/v2/resize:fit:1400/0*Sce5egkhwWpCeqF0.jpg" width="600" />
</div>

<p>At this point, we make a judgement call: this simply isn‚Äôt going to work at
Artsy. We‚Äôre here to empower folks and unlock productivity. Remember the team of
DevOps engineers on Platform who rebuilt a CMS in record time? In the new Next
13 model, that would be unfathomable, impossible even. Paper cuts would kill
motivation, and dishearten the already skeptical. And the front end already has
a bad rap, for good reason: historically, everything that seems like it should
be easy is hard and confusing for those who aren‚Äôt experts. And everything is
always changing. And the tooling is always breaking. And everybody always has a
bright new idea, one that will finally end this madness for good.</p>

<p>A certain amount of sadness is appropriate here, because Next‚Äôs <code class="language-plaintext highlighter-rouge">pages</code> router
was very, very close to being the silver bullet for web applications that we‚Äôve
all been looking for. Even though the <code class="language-plaintext highlighter-rouge">pages</code> router has its flaws, it showed us
that it‚Äôs possible to get something out the door very quickly with little prior
knowledge of Front End development. This is no small thing. Next 13‚Äôs fatal
error is that its destiny, being coupled to RSC, now requires experts. And by
‚Äòexpert‚Äô I mean: those with many years of experience dealing with JavaScript‚Äôs
whims, its complex eco-system, its changeover, as well as its problems. In
short, folks who have become numb to it all. This is no way to work.
<a href="https://www.reddit.com/r/nextjs/comments/1abd6wm/hitler_tried_rsc_and_next_14/">Thankfully the community is finally responding</a>.</p>

<h3 id="a-quick-note-on-performance">A Quick Note on Performance</h3>

<p>It‚Äôs worth remembering that Next 12 was industry-leading in terms of performance
and pioneered many innovative solutions. Let me say it again: Next‚Äôs pages
router IS fast. Next 13 combined with RSC <em>is</em> faster, but at what point does an
obsession with performance start negating other crucial factors? What‚Äôs good for
the 90%? And what‚Äôs required for the other 10%? Most companies just need
something that‚Äôs fast enough ‚Äì and easy enough ‚Äì to <em>move</em> fast. And not much
more.</p>

<h3 id="back-at-artsy">Back At Artsy‚Ä¶</h3>

<p>With all of this in mind, and with the uncertainty around long-term support for
Next.js <code class="language-plaintext highlighter-rouge">pages</code> (amongst other things), we recently decided to hit pause on
future development in our new external CMS app rebuild. Weighing a few different
factors (many entirely unrelated to Next), including a team reorg that allowed
us to look more closely (and fix) the DX in our old external CMS app, we took a
step back and recognized that our needs are actually quite minimal:</p>

<ul>
  <li>Instant hot reloading</li>
  <li>Fast, SPA-like UX performance</li>
  <li>Simple, convention-based file organization</li>
</ul>

<p>With these things covered, the ‚Äúweb framework‚Äù layer looks something like the
following, minus a few underlying router lib details:</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">createRouter</span><span class="p">({</span>
  <span class="na">history</span><span class="p">:</span> <span class="dl">'</span><span class="s1">browser</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">routes</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/foo</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">getComponent</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Foo</span><span class="dl">'</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/bar</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">getComponent</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Bar</span><span class="dl">'</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
</code></pre></div></div>

<p>We‚Äôre now required to manage our compiler config, but
<a href="https://github.com/shakacode/shakapacker">that layer</a> isn‚Äôt too complicated
once its setup, and it works great. (If you‚Äôre using something like <code class="language-plaintext highlighter-rouge">Vite</code>, it
could be even simpler.)</p>

<h3 id="final-thoughts">Final Thoughts</h3>

<p>Next 13 and React Server Components are very intriguing; it‚Äôs a new model of
thinking that folks are still trying to work out. Like other revolutionary
technologies released by Meta, sometimes it takes a few years to catch on, and
maybe RSC is firmly in that bucket. Vercel, however, would do well to remember
Next‚Äôs original fundamental insight ‚Äì that all good things follow from
developer experience. Improvements there tend to improve things everywhere.</p>

<p>In addition to fixing some of the obvious rough edges in the new <code class="language-plaintext highlighter-rouge">app</code> router,
it would be helpful if Next could provide an official response to
<a href="https://github.com/vercel/next.js/discussions/56655">the question of long-term Pages support</a>.
There‚Äôs been quite a backlash in the community against Next 13, and that should
give all developers pause. It‚Äôd also be great to get word on whether there will
be any further development on the pages router ‚Äì perhaps some of the features
from the new <code class="language-plaintext highlighter-rouge">app</code> router can be migrated to <code class="language-plaintext highlighter-rouge">pages</code> as well? ‚Äì or if the pages
router is officially deprecated and locked. All of this is currently ambiguous.</p>

<p>Another area where Next could improve is their willingness to ship buggy
features, and to rely on patched versions of React in order to achieve certain
ends. Even though Vercel employs many members of the React Core team, by
releasing Next versions that rely on patched and augmented <code class="language-plaintext highlighter-rouge">canary</code> builds of
React, Vercel is effectively compromising some of React‚Äôs integrity, and forcing
their hand. Once a neo-React feature is added to Next, it makes it hard to say
no; Next has captured too much of the market-share.</p>

<p>All of this calls for sobriety and hesitation on the part of developers working
with ‚Äì and building companies on top of ‚Äì Vercel‚Äôs products. Next is Open
Source, yes, but it‚Äôs also a wildcard. Artsy has had some real success with
Next, but sometimes that‚Äôs just not enough to avoid hitting pause, and looking
at the bigger picture. Inclusivity should always win.</p>

        </article>

        <article class='post'>
          <p style="padding-bottom: 0; margin-bottom:0;">
            <a href="https://www.artsy.net/" style="background-image: none;">
              <svg viewBox="0 0 510 510" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                <path transform="scale(1, -1) translate(0, -480)" d="M0 -32h512v512h-512v-512v0zM464 16h-80v80h-48v-80h-288v416h416v-416v0zM194 384h-40l-74 -186h38l20 52h72l19 -52h39l-74 186v0zM149 282l25 66l24 -66h-49v0z"></path>
              </svg>
            </a>
          <p/>
        </article>

        <aside class="related-articles"></aside>

      

      </section>

      <footer>
        <article>

          <section>
            <h4>Author</h4>
            <p></p>
            <p></p>
          </section>

          <section>
            <h4>Post Meta</h4>
            <p>Mar 7, 2024</p>
            <p>Tagged: </p>
          </section>
          <br/>
          <section>
            <h4>Artsy OSS</h4>
            <ul>
              <li><a href='https://www.artsy.net'>Artsy.net</a></li>
              <li><a href='https://github.com/artsy'>Github</a></li>
              <li><a href='https://github.com/orgs/artsy/repositories?language=&q=&sort=&type=source'>Open Source</a></li>
              <li><a href='https://www.artsy.net/jobs'>Careers</a></li>
            </ul>
          </section>

          <section>
            <h4>Blog</h4>
            <ul>
              <li><a href='http://artsy.github.io/blog/archives/'>Archives</a></li>
              <!-- TODO: bring back a different version of site search  -->
              <!-- <li><a href='http://artsy.github.io/search/'>Search</a></li> -->
              <li><a href='https://github.com/artsy/artsy.github.io'>Code on GitHub</a></li>
              <li><a href='https://github.com/artsy/artsy.github.io/edit/source/_posts/2024-03-07-nextjs-at-artsy-retrospective.markdown'>Fix typos in this post</a></li>
            </ul>
          </section>

        </article>

        <article>
          <section>
            <h4>Post Series on the Blog</h4>
            <ul>
              
              <li><a href='/series/react-native-at-artsy/'>React Native at Artsy</a></li>
              
              <li><a href='/series/javascriptures/'>JavaScriptures</a></li>
              
              <li><a href='/series/stages-of-professional-growth/'>Stages of Professional Growth</a></li>
              
              <li><a href='/series/artsy-tech-stack/'>Artsy Tech Stack</a></li>
              
              <li><a href='/series/open-source-by-default/'>Open Source by Default</a></li>
              
            </ul>
          </section>

          <section>
          
          </section>
        </article>

      </footer>
    </div>
  </div>
</body>
